[Первые графики](https://practicum.yandex.ru/learn/data-scientist/courses/f670adbe-d0c4-4571-a357-68083e410961/sprints/43477/topics/747f38c1-59e7-406e-8ca4-91b44b88893d/lessons/3cfb80d7-f164-47c2-8f0e-83508c7d82c3/)

**Гистограмма** это график, который показывает, как часто в наборе данных встречается то или иное значение
**Распределение** это все возможные значения переменной с частотой их появления
**Нормальное распределение** чаще всего встречается среднее значение и близкие к нему, а крайние значения встречаются довольно редко
**Распределение Пуассона** число событий в единицу времени, если они в среднем происходят с измеренной частотой.
**Характерный разброс** то, какие значения оказались вдали от среднего, и насколько их много
**Числовое описание данных** - среднее, медиана, стандартное отклонение, количество наблюдений в выборке и разброс их значений
**Квартиль** число, разбивающее выборку на две части: значения в одной части меньше квартиля, а в другой - больше.
**Первый квартиль** Q1 25% элементов меньше, а 75% – больше него
**Второй квартиль** Q2 (медиана) половина элементов больше и половина меньше неё
**Третий квартиль** Q3 75% элементов меньше и 25% элементов больше него
**Межквартильный размах** это расстояние между первым Q1 и третьим Q3 квартилями
**Стандартное отклонение** числовая характеристика данных, которая показывает, насколько значения в выборке отличаются от среднего арифметического

-   Строить гистограммы методом `hist()` и диаграммы размаха методом `boxplot()`.
-   Определять типы распределений: нормальное и Пуассона.
-   Получать числовое описание данных методом `describe()`.

```python
import pandas as pd
data = pd.read_csv('/datasets/visits.csv')
print(data.head()) 
file = pd.read_csv('file.csv', sep=';', decimal=',')
arecibo = pd.read_csv('arecibo.txt', sep='\\')
print(arecibo.head())

```

```python
import pandas as pd

data = pd.read_csv('/datasets/visits.csv', sep='\t')

print(data.head(5))
```

### Урок 3. Сводные таблицы для расчёта среднего

`pivot_table()` _—_ метод для построения сводных таблиц. Параметры:

-   `index` — столбец, значения которого становятся названиями строк (индексом);
-   `columns` — столбец, значения которого становятся названиями столбцов;
-   `values` — значения, по которым вы хотите увидеть сводную таблицу;
-   `aggfunc` — функция, применяемая к значениям. Например `sum.` Если параметр `aggfunc` не указывать, то по умолчанию метод `pivot_table()` рассчитает среднее арифметическое значений, указанных в параметре `values`.

```python
nhl_att = pd.read_excel('nhl_attendance.xlsx') 
print(nhl_att.head())
nhl_att['avg_home_att'] = nhl_att['home_att'] / nhl_att['home_games'] 
print(nhl_att.head())
nhl_pivot = nhl_att.pivot_table(index='season', values='avg_home_att') 
# группируем таблицу по сезонам, для каждого находим среднюю посещаемость 
print(nhl_pivot)
```

### Урок 4. Применяем сводные таблицы
```python
import pandas as pd

data = pd.read_csv ('/datasets/visits.csv', sep='\t')

stat = data.pivot_table(index='name', values='time_spent') 

print(stat)
```


### Урок 5. [Есть ли проблемы в данных?](https://practicum.yandex.ru/trainer/data-scientist/lesson/49759259-9438-4efc-a8d9-e09a653ec9b8/)
```python
import pandas as pd

data = pd.read_csv ('/datasets/visits.csv', sep='\t')

#количество заездов на АЗС
total_visits = len(data)
total_visits = data.shape[0]

print(f'Количество заездов: {total_visits}')

total_stations = data['id'].nunique()

print(f'Количество АЗС: {total_stations}')
print(data['date_time'].min(), data['date_time'].max())

total_days = pd.to_datetime(data['date_time'].max(), format='%Y.%m.%dT%H:%M:%S') - pd.to_datetime(data['date_time'].min(), format='%Y.%m.%dT%H:%M:%S')
total_days = str(total_days)
total_days=int(total_days.split()[0]) + 1

station_visits_per_day = total_visits / total_days / total_stations

print(f'Количество заездов на АЗС в сутки: {station_visits_per_day}')

print(data['name'].value_counts().head(10))
```

### Урок 6. Базовая проверка данных
```python
import pandas as pd

data = pd.read_csv ('/datasets/visits.csv', sep='\t')

# отображение гистограммы с числом корзин n_bins и отображаемыми 
# минимальным и максимальным значением min_value и max_value
data.hist('time_spent', bins=100, range=(0, 1500))

```

### Урок 7. Гистограмма
Гистограмма — это график, который показывает, как часто в наборе данных встречается то или иное значение. Гистограмма объединяет числовые значения по диапазонам, то есть считает частоту значений в пределах каждого интервала. Её построение подобно работе знакомого вам метода `value_counts()`, подсчитывающего количество уникальных значений в списке. `value_counts()` группирует строго одинаковые величины и хорош для подсчёта частоты в списках с категориальными переменными.
Гистограмма поможет оценить форму распределения и частоту каждого очка в наборе данных. Самое высокое значение на гистограмме — самое распространённое. Но для визуализации медианы или общего количества значений по категориям гистограмма не подойдёт.
```python
simpsons = pd.read_csv('simpsons.csv') 
print(simpsons.head())
print(simpsons['imdb_rating'].value_counts())
```
![[Pasted image 20220910152319.png]]
В pandas гистограмму строит специальный метод `hist()` (от англ. histogram — «гистограмма»). Применять его можно к списку или к столбцу датафрейма: во втором случае название столбца передаётся в параметре. Метод `hist()` находит в наборе чисел минимальное и максимальное значения, а полученный диапазон делит на области, или корзины. Затем `hist()` считает, сколько значений попало в каждую корзину, и отображает это на графике.

Параметр `bins` (пер. «корзины, вёдра») определяет, на сколько областей делить диапазон данных. По умолчанию таких «корзин» 10.
Изменить масштаб вручную можно указав диапазон значений, по которым следует строить график. Границы интересующего интервала указывают в параметре `range` (пер. «диапазон»): `range=(min_value, max_value)`.
Гистограмма даёт представление о структуре данных. В частности, по ней можно понять, откуда взялось такое среднее арифметическое.
Если смотреть только на среднее значение наборов данных, можно сказать, что они очень похожи. Однако описывающие их гистограммы могут дают понять, что это два очень разных явления
Для создания графиков (в том числе гистограмм), импортируют библиотеку ` matplotlib.` Метод ` show() ` отображает графики.


### Урок 7. Задачи
```python
import pandas as pd

data = pd.read_csv ('/datasets/visits.csv', sep='\t')

data.hist('time_spent', bins=100, range=(0, 1500))
```

### Урок 8. Гистограмма для двух кубиков
Аналитик должен представлять себе гистограмму ожидаемого вида, чтобы знать, когда стоит насторожиться. Для некоторых явлений можно выяснить все возможные значения и описать частоту их появления — это называется «распределение».
```python
import random
import pandas as pd

print(random.randint(1, 5))
score = random.randint(1, 6)
# от англ. dice — «кубик», 
# roll — «бросок» 
def dice_roll(): 
	score = random.randint(1, 6) 
	return score
print(dice_roll())

def double_roll_score(): 
	first = dice_roll() 
	second = dice_roll() 
	score = first + second 
	return score 
print(double_roll_score())

# Cоздаём пустой список. В него 
# попадут результаты экспериментов.
experiments = []
for i in range(1000):
    score = double_roll_score()
    # Напомним: метод append() добавляет новый
    # элемент score в конец списка experiments.
    experiments.append(score)

df_experiments = pd.DataFrame(experiments)
df_experiments.hist(bins=11, range=(2, 12))

```

### Урок 8. Задачи
#### Задача 1. 
Бросаем 10 монет и считаем количество выпавших орлов. И строим гистограмму полученных значений с диапазоном значений от 0 до 10 и количеством корзин 11.

```python
import random
import pandas as pd
# Функция, имитирующая один бросок монеты.
# От англ. coin - монета, flip - бросок монеты.
def coin_flip():
    # возможны два варианта:
    # - выпала решка, это +0 орлов
    # - выпал орёл, это +1 орёл
    score = random.randint(0, 1)
    return score
# Функция для суммирования числа орлов в нескольких бросках.
# Орёл и решка переводятся на английский как heads и tails.
# Аргумент repeat говорит, сколько раз бросать монету
# (от англ. repeat - повторение).
def flips_heads(repeat):
    total = 0
    for i in range(repeat):
        flip = coin_flip()
        total += flip
    return total
# Cоздаём пустой список. В него мы
# будем складывать результаты экспериментов.
experiments = []
for i in range(1000):
    score = flips_heads(10)
    # Напомним: функция append() добавляет новый
    # элемент score в конец списка experiments.
    experiments.append(score)
# превращаем список в DataFrame
df_experiments = pd.DataFrame(experiments)
# постройте гистограмму для df_experiments
print(df_experiments.head(2))

df_experiments.hist(bins=11, range=(0, 10))
```

#### Задача 2. 
Пострить гистограмму опозданий Валеры за 5 лет c параметром `bins=10`. Будем считать, что автобус прибывает за время от 0 до 10 минут, а поезд — за время от 0 до 5 минут.
```python
import random
import pandas as pd

# Функция, имитирующая время ожидания автобуса.
# (от англ. bus - автобус, wait - ждать, time - время)
def bus_wait_time():
    return random.randint(0, 10)


# Функция, имитирующая время ожидания поезда в метро.
# (от англ. train - поезд, wait - ждать, time - время)
def train_wait_time():
    return random.randint(0, 5)


# Функция подсчёта полного опоздания за день.
# от англ. total - полный, итоговый, delay - задержка, опоздание
def total_delay():
    # обратите внимание, как в Python переносят длинные строки
    return (
        bus_wait_time()
        + train_wait_time()
        + train_wait_time()
        + bus_wait_time()
    )


# создайте пустой список
days = [] # list()

for i in range(365 * 5):
    delay = total_delay()
    # добавьте опоздание в список days
    # элемент score в конец списка experiments.
    days.append(delay)    

# превращаем список в DataFrame
df_days = pd.DataFrame(days)
#print(df_days)
# постройте гистограмму для df_days
df_days.hist(bins=10)

```

### Урок 9. Распределения
**Распределение** - это все возможные значения переменной с частотой их появления.
Наиболее частые (типичные, нормальные) значения оказываются посередине. А редкие — по краям. График симметричен и напоминает колокол. Такое распределение называется нормальным. 
Нормальные или тяготеющие к ним распределения распространены в жизни. Так распределяется рост людей, размер яблок, результаты измерения температуры. Понимание природы распределений необходимо для обнаружения важных аномалий.
![[Pasted image 20220910160140.png]]
Так, измеряя длину изготовленных на заводе деталей, мы ожидаем распределение, тяготеющее к нормальному. Если же в результате расчётов получили распределение, скажем, с двумя пиками, это должно насторожить аналитика. Такое может быть, если на заводе есть две производственные линии и с одной из них приходят данные в сантиметрах, а с другой — в метрах.

Ещё одно распределение, которое часто встречается, — распределение Пуассона. Оно описывает число событий в единицу времени.
Например, в среднем в магазин заходит два человека в минуту. Но это не значит, что каждую минуту заходит ровно два человека. Может, в эту минуту не зайдёт ни одного, а через минуту зайдёт пять. Если каждый посетитель заходит случайным образом, независимо от других, то это и есть распределение Пуассона:
![[Pasted image 20220910161436.png]]
Форма распределения Пуассона зависит от числа событий. При небольших значениях распределение смещено влево, а с увеличением числа событий становится симметричным и уходит вправо.
Невозможно получить отрицательное число заходов в магазин, но при небольшом потоке посетителей есть шанс, что в определённую минуту придут пять посетителей или не придёт ни одного. В таком случае распределение Пуассона обрезано на нуле и имеет длинный «хвост» в положительную сторону. При увеличении числа посетителей шанс не получить ни одного захода в магазин уже почти не реализуется, поэтому распределение Пуассона становится симметричным и стремится к нормальному.

### Урок 10. Диаграмма размаха
**Характерный разброс** — то, какие значения оказались вдали от среднего, и насколько их много. Если считать характерным разбросом расстояние между минимальным и максимальным значением, то мы не всегда получим точное описание данных, на него могут повлиять выбросы. Поэтому, в качестве характерного разброса применяют межквартильный размах.

```
data['time_spent'].hist(bins=100, range=(0, 1500));
```
Странно, что есть пик около 0!?
Описывая распределение, аналитики рассчитывают среднее арифметическое или медиану. С соответствующими методами `mean()` и `median()` вы познакомились в курсе по предобработке данных. Однако, помимо медианы и среднего, важно знать характерный разброс — то, какие значения оказались вдали от среднего и насколько их много.
Самое простое, что можно посчитать для оценки разброса, — это минимальное и максимальное значения. Такое описание не всегда точно, подвержено влиянию выбросов. Гораздо более устойчивая оценка — межквар**тиль**ный размах.
Квартили (от лат. quartus — «четвёртый») разбивают упорядоченный набор данных на четыре части. Первый квартиль Q1 — число, отделяющее первую четверть выборки: 25% элементов меньше, а 75% — больше него. Медиана — второй квартиль Q2, половина элементов больше и половина меньше неё. Третий квартиль Q3 — это отсечка трёх четвертей: 75% элементов меньше и 25% элементов больше него_._ Межквартильный размах — это расстояние между Q1 и Q3.
![[Pasted image 20220910163641.png]]

Увидеть медиану и квартили в Python можно на специальном графике. Его называют диаграммой размаха или «ящиком с усами».
«Ящик» ограничен первым и третьим квартилями. Внутри ящика обозначают медиану.
![[Pasted image 20220910204256.png]]
«Усы» простираются влево и вправо от границ ящика на расстояние, равное 1,5 межквартильного размаха (сокращённо IQR, от англ. interquartile range, «межквартильный размах»). В размах «усов» попадают нормальные значения, а за пределами находятся выбросы, изображённые точками. Если правый «ус» длиннее максимума, то он заканчивается максимумом. То же — для минимума и левого «уса».

### Урок 11. Диаграмма размаха в Python
Диаграмма размаха — непростой график. Нужно знать, как такой график устроен, чтобы интерпретировать результат. Диаграмму размаха ещё иногда называют «ящик с усами». На графике действительно есть «ящик»: он ограничен первым и третьим квартилями и отображает межквартильный размах. «Ящик» раздёлен линией — это медиана. «Усами» на графике отмечены пределы нормальных значений. За пределами «усов» находятся выбросы, изображённые точками.
В Python диаграмму размаха строят методом `boxplot()` (от англ. box-and-whisker plot — «график „ящик с усами“»).
Метод `boxplot()` позволяет визуально оценить характеристики распределения, не прибегая к гистограмме. Удобно, когда нужно сравнить разные выборки.

```PYTHON
data.boxplot(column='column')

plt.show()

```

Для продвинутой работы с графиками библиотека   ` matplotlib
Методы `xlim(x_min, x_max)`,  `ylim(y_min, y_max)` - х-limits — «пределы по оси абсцисс», y-limits — «пределы по оси ординат»

```PYTHON
import matplotlib.pyplot as plt
import pandas as pd

data = pd.read_csv ('/datasets/visits.csv', sep='\t')
plt.ylim(-100, 1000)

data.boxplot() 
```

### Урок 12. Описание данных
Заметные на гистограмме нюансы распределения хорошо бы зафиксировать в числах: иметь под рукой среднее, медиану, количество наблюдений в выборке и разброс их значений. Такие характеристики, дающие представление о выборке, входят в числовое описание данных. В Python его получают методом `describe()` (пер. «описать, охарактеризовать»). Результат работы метода — список характерных значений:

```PYTHON
print(data.describe())

count    3.0 # количество наблюдений в наборе данных 
mean     2.0 # среднее арифметическое 
std      1.0 # стандартное отклонение 
min      1.0 # минимальное значение 
25%      1.5 # первый квартиль 
50%      2.0 # медиана, или второй квартиль 
75%      2.5 # третий квартиль 
max      3.0 # максимальное значение 

dtype: float64 # тип данных`
```
Если среднее сильно больше медианы, значит, в распределении есть длинный хвост с высокими значениями или несколько очень больших значений. Это влияет на среднее, но не на медиану.

Описание данных может быть не только дополнением к графикам, но и самодостаточной боевой единицей первичного анализа. Если в данных много столбцов или нужно сравнить несколько выборок, аналитики обращаются к числовому описанию, а не к графикам.
**Стандартное отклонение** — единственное значение, которого мы ещё не касались. Оно характеризует разброс величин и показывает, насколько значения в выборке отличаются от среднего арифметического.
Бывает, что именно стандартное отклонение позволяет понять природу распределения и выяснить, насколько значения однородны. Выборка, где все значения близки к среднему, будет охарактеризована малым стандартным отклонением. Если же стандартное отклонение велико, в наборе данных могут быть серьёзные аномалии или выбросы.

**Например:**
Средний балл учениеков — 4,09. Если исходить только из него, кажется, что Виктор с Иваном получают примерно похожие отметки, да и учатся, скорее всего, одинаково. Но посмотрите на стандартное отклонение — 0,7 у Виктора и 1,4 у Ивана. В два раза больше! Судя по стандартному отклонению, успеваемость у них распределяется по-разному. Оценки Виктора тяготеют к четвёрке, тогда как у Ивана отклонение от среднего столь велико, что четвёрок он мог и не получать. Изучим классный журнал:

```
Середнячко Виктор: 4, 4, 5, 3, 4, 4, 4, 5, 3, 4, 5`   

Контрастов Иван: 5, 5, 5, 5, 5, 5, 5, 4, 2, 2, 2`
```


Чтобы ничего не забыть, [скачайте шпаргалку](https://code.s3.yandex.net/data-analyst/conspects/praktikum_data_analysis_takeaways_course3_theme1.pdf) и [конспект темы](https://code.s3.yandex.net/data-analyst/conspects/praktikum_data_analysis_abstract_course3_theme1.pdf).

### Где ещё почитать про гистограммы, ящик с усами и описательную статистику

[Гистограммы](https://habr.com/ru/company/ods/blog/323210/)  
[Описательные статистики: среднее, медиана, стандартное отклонение, перцентили](http://statistica.ru/theory/opisatelnye-statistiki/)